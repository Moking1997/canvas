<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      canvas {
        border: 1px solid #999;
        background: #999;
      }
    </style>
  </head>

  <body>
    <canvas id="canvas" width="1200" height="1200"></canvas>
  </body>
  <script>
    const log = console.log.bind(console);
    const canvas = document.querySelector("#canvas");
    const context = canvas.getContext("2d");

    const colors = [
      "#f44336",
      "#e91e63",
      "#9c27b0",
      "#673ab7",
      "#3f51b5",
      "#2196f3",
      "#03a9f4",
      "#00bcd4",
      "#009688",
      "#4CAF50",
      "#8BC34A",
      "#CDDC39",
      "#FFEB3B",
      "#FFC107",
      "#FF9800",
      "#FF5722",
    ];

    class Ball {
      constructor(x, y, radius, color) {
        this.x = x;
        this.y = y;
        this.vx = 3;
        this.vy = 0;
        this.radius = 1 ;
        this.speed = 0.5
        this.radiusMax =  radius;
        this.angle = 0;
        this.color = color || "#fff";
      }

      draw(ctx) {
        ctx.save();
        ctx.fillStyle = this.color;
        ctx.beginPath();
        this.setRadius()
        ctx.arc(this.x, this.y, this.radius, Math.PI * 2, false);
        ctx.closePath();
        ctx.fill();
        ctx.restore();
      }

      move() {
        this.x += this.vx;
        this.y += this.vy;
      }

      setRadius(){
        this.radius += this.speed
        if (this.radius >= this.radiusMax || this.radius <= 1) {
          this.speed *= -1
        } 
      }

      update(context) {
        // this.move();
        this.draw(context);
      }
    }

    class Shape {
      constructor(text) {
        this.x = 0;
        this.y = 0;
        this.size = 200;
        this.text = text;
        this.textZone = [];
        this.spaceX = 10
        this.spaceY = 10
      }

      draw(ctx) {
        ctx.save();
        ctx.textAlign = "center";
        ctx.font = this.size + "px arial";
        ctx.fillText(this.text, canvas.width / 2, canvas.height / 2);
        ctx.restore();

        let imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);

        let buffer32 = new Uint32Array(imgData.data.buffer);
        for (let i = 0; i < canvas.width; i+=this.spaceX) {
          for (let j = 0; j < canvas.height; j+=this.spaceY){
            if (buffer32[canvas.width * j + i]) {
              let color = colors[Math.floor(Math.random() * colors.length)]
              let particle = new Ball(i, j, 10, color);
              this.textZone.push(particle);
            }
          }
        }
        ctx.clearRect(0, 0, canvas.width, canvas.height);
      }

      getValue() {}
    }

    let shape = new Shape("店宝宝");
    shape.draw(context);
    log(shape.textZone[0]);
    for (var i = 0; i < shape.textZone.length; i++) {
      shape.textZone[i].draw(context);
    }
    // let particle = new Ball(100, 100, 10, '#49f');
    // particle.draw(context)
    const drawFrame = function () {
      window.requestAnimationFrame(drawFrame);
      context.clearRect(0, 0, canvas.width, canvas.height);
      for (var i = 0; i < shape.textZone.length; i++) {
        shape.textZone[i].update(context);
      }
      // particle.update(context)
    };

    drawFrame();
  </script>
</html>
